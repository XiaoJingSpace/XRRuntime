# 图表和截图处理说明

## 📊 Word 文档中的图表支持

Word 文档现在支持自动插入以下类型的图表和截图：

### 1. Mermaid 图表

#### 自动处理流程

1. **转换图表**: 运行 `python scripts/convert_all_mermaid.py` 将所有 Mermaid 图表转换为 PNG 图片
2. **生成 Word**: 运行 `python scripts/md_to_docx.py`，脚本会自动查找并插入转换后的图片
3. **占位符**: 如果图片不存在，会显示占位符和提示信息

#### 转换方法

**方法1: 在线转换（默认）**
- 脚本会自动使用 Mermaid Live Editor API
- 无需安装额外工具
- 需要网络连接

**方法2: 手动转换**
1. 访问 [Mermaid Live Editor](https://mermaid.live/)
2. 粘贴 Mermaid 代码
3. 点击 "Download PNG"
4. 保存到 `book/images/mermaid/`，命名为 `mermaid_<hash>.png`

**方法3: 使用 mermaid-cli（推荐用于批量处理）**
```bash
npm install -g @mermaid-js/mermaid-cli
mmdc -i diagram.mmd -o diagram.png
```

### 2. 截图

#### 添加流程

1. **准备截图**: 按照 [截图添加指南](images/截图添加指南.md) 准备截图
2. **保存文件**: 保存到 `book/images/` 对应目录
3. **Markdown 引用**: 在 Markdown 中使用 `![描述](images/filename.png)` 引用
4. **自动插入**: 运行 `python scripts/md_to_docx.py` 自动插入 Word

#### 截图要求

- **格式**: PNG（推荐）或 JPG
- **分辨率**: 1920x1080 或更高
- **大小**: 每个文件 < 2MB
- **命名**: `chapterXX_sectionXX_description.png`

## 🔧 完整工作流程

### 步骤1: 准备图表和截图

```bash
# 1. 转换所有 Mermaid 图表
python scripts/convert_all_mermaid.py

# 2. 检查转换结果
ls book/images/mermaid/

# 3. 准备截图（手动）
# 按照截图添加指南准备截图文件
```

### 步骤2: 更新 Markdown（如果需要）

在 Markdown 文件中添加图片引用：

```markdown
![描述文字](images/filename.png)
```

### 步骤3: 生成 Word 文档

```bash
python scripts/md_to_docx.py
```

脚本会自动：
- ✅ 识别 Mermaid 图表并插入对应图片
- ✅ 识别图片引用并插入截图
- ✅ 如果图片不存在，显示占位符

## 📋 当前状态

### Mermaid 图表

- **已添加**: 9个 Mermaid 图表
- **已转换**: 部分图表已转换为图片
- **待转换**: 需要运行转换脚本完成所有图表

### 截图

- **需要添加**: 25个截图
- **已添加**: 0个（需要手动准备）
- **占位符**: 已在 Markdown 中标注位置

## 🎯 快速开始

### 一次性完成所有转换

创建 `scripts/build_with_images.bat` (Windows):

```batch
@echo off
echo 1. 转换 Mermaid 图表...
python scripts/convert_all_mermaid.py

echo.
echo 2. 生成 Word 文档...
python scripts/md_to_docx.py

echo.
echo 完成！
pause
```

## ⚠️ 注意事项

1. **Mermaid 图表**: 必须先转换为图片才能插入 Word
2. **截图路径**: 使用相对路径，从 `book/` 目录开始
3. **图片大小**: 建议每个图片不超过 2MB
4. **网络连接**: 在线转换需要网络连接
5. **文件占用**: 如果 Word 文档被打开，会保存为临时文件

## 🔍 故障排除

### Mermaid 图表未显示

1. 检查图片文件是否存在: `book/images/mermaid/mermaid_*.png`
2. 运行转换脚本: `python scripts/convert_all_mermaid.py`
3. 检查网络连接（如果使用在线转换）
4. 查看控制台输出的错误信息

### 截图未显示

1. 检查图片路径是否正确
2. 确认图片文件存在
3. 检查 Markdown 中的引用格式: `![alt](path)`
4. 确认路径是相对路径（从 `book/` 开始）

### 图片插入失败

1. 检查图片文件大小（建议 < 2MB）
2. 确认图片格式（PNG 或 JPG）
3. 检查文件权限
4. 查看控制台错误信息

## 📚 参考文档

- [图表清单](图表清单.md) - 完整的图表清单
- [图表添加总结](图表添加总结.md) - 图表添加总结
- [截图添加指南](images/截图添加指南.md) - 详细的截图指南
- [脚本说明](scripts/README_图表处理.md) - 脚本使用说明

